<!DOCTYPE html>
<html ng-app="myapp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8" />
    <title>BCM extraction</title>

    <!-- Références BlankCordovaApp1 -->
    <link href="css/index.css" rel="stylesheet" />
    <link href="lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="lib/angular/angular.min.js"></script>
    <script type="text/javascript" src="lib/angular-route/angular-route.min.js"></script>
    <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="lib/bootstrap/dist/js/bootstrap.min.js"></script>    
    <script type="text/javascript">
        var myapp = angular.module('myapp', ['ngRoute','AllCtr']);
        myapp.config(['$routeProvider',
          function ($routeProvider) {
              $routeProvider.
                when('/', {
                    templateUrl: 'bank.html',
                    controller: 'ChangeController'
                }).
				when('/bank',{
					templateUrl: 'bank.html',
                    controller: 'ChangeController'
				}).
				when('/drugStore',{
					templateUrl: 'drugStore.html',
                    controller: 'drugStoreController'
				}).
                otherwise({
                    redirectTo: '/'
                });
          }]);
        var ctr = angular.module('AllCtr',[]);
        ctr.controller('ChangeController', ['$scope', '$http', function ($scope, $http) { 
			$scope.m_q='1';
            $scope.money = [];
            $scope.moneyRate = {};            
            $scope.changeRate = function (rate) {
                $scope.m_p = $scope.moneyRate[rate];                
                return $scope.moneyRate[rate];                
            };
            
            $http.get('/bank/proxy.php').success(function (data,status) {
				if($(data).find('.xdebug-error').length!=0){						
					$scope.api = function () {
						return 'Cannot connect to Madagascar Central Bank';
					};					
				}
				else{
					var table = $(data).find('table').get(6);//1ère table contenant les devises
					var tr = $(table).find('tr').get(0);//1ère tr
					var td = $(tr).find('td').get(0);//1ère td
					var date = $(td).find('strong').get(0);//1ère strong dans 1ère td
					var context = $(td).find('table').get(0);//1ère table dans 1ère td				
					$(context).find('tr').each(function (i_, tr_) {
						var temp='';
						$(tr_).find('td').each(function (i__, td_) {
							if(i__==0){
								temp=$(td_).text();                            							
								$scope.money[i_] = temp.trim();								
								//$('#m_c').append('<option value="' + $scope.money[i_] + '">' + $scope.money[i_] + '</option>');							
							}
							else{							
								$scope.moneyRate[temp] = $(td_).text().split(' ').join('').replace(',','.');
							}                        
						});
					});
					$scope.m_c='EUR';
					//$('#tb').append($(context).html());
					
				}
				$('.ajax').hide();
				$('.loading').show();
                				
            }).error(function (status) {
				$('.ajax').hide();
				$('.loading').show();
                $scope.money = ['EUR','USD'];
                $scope.moneyRate = {'EUR':3125.4,'USD':2300};
                $scope.api = function () {
                    return 'Cannot connect to Madagascar Central Bank';
                };				
            });
        }]);       
		ctr.controller('drugStoreController',['$scope','$http',function($scope,$http){
		
		}]);
	</script>
</head>
<body>
    <!-- Référence Cordova ajoutée à votre application une fois générée. -->      
    <div class="container">
		<ul class="nav navbar-nav">
			<li><a href="#/bank">Exchange Rate</a></li>
			<li><a href="#/drugStore">Drug Store</a></li>
		</ul>
		<div class="col-xs-12">
				<div ng-view></div>
         </div>                   
    </div>
</body>
</html>